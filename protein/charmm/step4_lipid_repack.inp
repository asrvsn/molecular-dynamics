* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v1.8 on Mar, 27. 2016.
* REPLACE PACKED BIG SPHERES BY LIPID MOLECULES OF RANDOM CONFORMATION
*

DIMENS CHSIZE 2000000
!DIMENS CHSIZE 1000000

! Read topology and parameter files
stream toppar.str

! Read PSF and Coordinates
open read unit 10 card name step4_lipid.psf
read psf  unit 10 card

open read unit 10 card name step4_lipid.crd
read coor unit 10 card

! update lipid coordinate
open read unit 10 card name step4_lipid_lipid.crd
read coor unit 10 card resid

define PROT sele all end

! Read the system information
stream step3_size.str
stream step3_nlipids_upper.prm
stream step3_nlipids_lower.prm
stream step3_packing_pol.str
stream step4_lipid_rings.str

calc nchl1 = @nchl1top + @nchl1bot

coor stat

set nlipid = 1
set badsegid1 = PROA
set badresid1 = 10
!Random number generation for picking lipids
RAND UNIF ISEED 1459071907

set LipidNum = 1

label loop_gen

   define repack sele segid @badsegid@@LipidNum .and. resi @badresid@@LipidNum end
   coor stat sele repack end
   set lipid = ?selresn

   set cntrand = 0

   !prnlev 0

   if lipid .eq. CHL1 then
      calc zpostop = 18
      set HG ( type C3 .or. type O3 )
      set TL ( type C26 .or. type C27 )
      goto repeatrand
   endif
   if lipid .eq. ERG then
      calc zpostop = 18
      set HG ( type C3 .or. type O3 )
      set TL ( type C26 .or. type C27 )
      goto repeatrand
   endif
   if lipid .eq. DLPA then
      calc zpostop = 15
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C212 .or. type C312 )
      goto repeatrand
   endif
   if lipid .eq. DMPA then
      calc zpostop = 17
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DPPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DSPA then
      calc zpostop = 21
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. POPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SOPA then
      calc zpostop = 21
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SLPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DXPA then
      calc zpostop = 17
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. YOPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DOPA then
      calc zpostop = 19
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DGPA then
      calc zpostop = 21
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DEPA then
      calc zpostop = 23
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C222 .or. type C322 )
      goto repeatrand
   endif
   if lipid .eq. DNPA then
      calc zpostop = 25
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C224 .or. type C324 )
      goto repeatrand
   endif
   if lipid .eq. DLPC then
      calc zpostop = 15
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C212 .or. type C312 )
      goto repeatrand
   endif
   if lipid .eq. DMPC then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DPPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DSPC then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. POPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPC then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SOPC then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SLPC then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DYPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. YOPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DOPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DUPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DGPC then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DEPC then
      calc zpostop = 23
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C222 .or. type C322 )
      goto repeatrand
   endif
   if lipid .eq. DNPC then
      calc zpostop = 25
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C224 .or. type C324 )
      goto repeatrand
   endif
   if lipid .eq. DLPE then
      calc zpostop = 15
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C212 .or. type C312 )
      goto repeatrand
   endif
   if lipid .eq. DMPE then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DPPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DSPE then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. PYPE then
      calc zpostop = 21.5
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPE then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SOPE then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SLPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DYPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. YOPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. OSPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DOPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DGPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DEPE then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C222 .or. type C322 )
      goto repeatrand
   endif
   if lipid .eq. DNPE then
      calc zpostop = 25
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C224 .or. type C324 )
      goto repeatrand
   endif
   if lipid .eq. DLPG then
      calc zpostop = 15
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C212 .or. type C312 )
      goto repeatrand
   endif
   if lipid .eq. DMPG then
      calc zpostop = 17
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DPPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DSPG then
      calc zpostop = 21
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. PSPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPG then
      calc zpostop = 17
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SOPG then
      calc zpostop = 21
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SLPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DXPG then
      calc zpostop = 17
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DOPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DGPG then
      calc zpostop = 21
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DEPG then
      calc zpostop = 23
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C222 .or. type C322 )
      goto repeatrand
   endif
   if lipid .eq. DNPG then
      calc zpostop = 25
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C224 .or. type C324 )
      goto repeatrand
   endif
   if lipid .eq. DLPS then
      calc zpostop = 15
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C212 .or. type C312 )
      goto repeatrand
   endif
   if lipid .eq. DMPS then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DPPS then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DSPS then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. POPS then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPS then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SOPS then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SLPS then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DXPS then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. YOPS then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. DOPS then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C218 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DGPS then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DEPS then
      calc zpostop = 23
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C222 .or. type C322 )
      goto repeatrand
   endif
   if lipid .eq. DNPS then
      calc zpostop = 25
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C224 .or. type C324 )
      goto repeatrand
   endif
   if lipid .eq. DMPI then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI13 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI14 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI15 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI24 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI25 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI2A then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI2B then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI2C then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI2D then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI33 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI34 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. DMPI35 then
      calc zpostop = 17
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C214 .or. type C314 )
      goto repeatrand
   endif
   if lipid .eq. PYPI then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI13 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI14 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI15 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI24 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI25 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI2A then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI2B then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI2C then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI2D then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI33 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI34 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. POPI35 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI13 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI14 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI15 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI24 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI25 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI2A then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI2B then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI2C then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI2D then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI33 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI34 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PLPI35 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI13 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI14 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI15 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI24 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI25 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI2A then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI2B then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI2C then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI2D then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI33 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI34 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PNPI35 then
      calc zpostop = 19
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. SAPI then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI13 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI14 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI15 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI24 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI25 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI2A then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI2B then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI2C then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI2D then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI33 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI34 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPI35 then
      calc zpostop = 20
      set HG ( type P .or. type O1+ .or. type C1 .or. type C2 .or. type C3 )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. TMCL1 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%14 )
      goto repeatrand
   endif
   if lipid .eq. TMCL2 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%14 )
      goto repeatrand
   endif
   if lipid .eq. PMCL1 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%16 )
      goto repeatrand
   endif
   if lipid .eq. PMCL2 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%16 )
      goto repeatrand
   endif
   if lipid .eq. PVCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type CA18 .or. type CB16 .or. type CC18 .or. type CD16 )
      goto repeatrand
   endif
   if lipid .eq. TXCL1 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%16 )
      goto repeatrand
   endif
   if lipid .eq. TXCL2 then
      calc zpostop = 17
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%16 )
      goto repeatrand
   endif
   if lipid .eq. TOCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. TOCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LOACL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LOACL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LOCCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LOCCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. TLCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. TLCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNCCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNCCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNACL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNACL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNDCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNDCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNBCL1 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. LNBCL2 then
      calc zpostop = 19
      set HG ( type P+ .or. type OP++ .or. type C1+ .or. type C2 .or. type C3+ )
      set TL ( type C%18 )
      goto repeatrand
   endif
   if lipid .eq. SAPA then
      calc zpostop = 20
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPC then
      calc zpostop = 20
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPE then
      calc zpostop = 20
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPG then
      calc zpostop = 20
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SAPS then
      calc zpostop = 20
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C220 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SDPA then
      calc zpostop = 20.5
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C222 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SDPC then
      calc zpostop = 20.5
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C222 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SDPE then
      calc zpostop = 20.5
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C222 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SDPG then
      calc zpostop = 20.5
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C222 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. SDPS then
      calc zpostop = 20.5
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C222 .or. type C318 )
      goto repeatrand
   endif
   if lipid .eq. DAPA then
      calc zpostop = 18
      set HG ( type P .or. type C1 .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DAPC then
      calc zpostop = 18
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DAPE then
      calc zpostop = 18
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DAPG then
      calc zpostop = 18
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. DAPS then
      calc zpostop = 18
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ .or. type O13% )
      set TL ( type C220 .or. type C320 )
      goto repeatrand
   endif
   if lipid .eq. PSM then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C16F )
      goto repeatrand
   endif
   if lipid .eq. SSM then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C18F )
      goto repeatrand
   endif
   if lipid .eq. ASM then
      calc zpostop = 23
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C20F )
      goto repeatrand
   endif
   if lipid .eq. BSM then
      calc zpostop = 25
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C22F )
      goto repeatrand
   endif
   if lipid .eq. 23SM then
      calc zpostop = 26
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C23F )
      goto repeatrand
   endif
   if lipid .eq. LSM then
      calc zpostop = 27
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C24F )
      goto repeatrand
   endif
   if lipid .eq. OSM then
      calc zpostop = 21
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C18F )
      goto repeatrand
   endif
   if lipid .eq. NSM then
      calc zpostop = 27
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C18S .or. type C24F )
      goto repeatrand
   endif
   if lipid .eq. CER160 then
      calc zpostop = 19
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C16F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER180 then
      calc zpostop = 19
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C18F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER181 then
      calc zpostop = 19
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C18F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER200 then
      calc zpostop = 22
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C20F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER220 then
      calc zpostop = 22
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C22F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER240 then
      calc zpostop = 24
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C24F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. CER241 then
      calc zpostop = 24
      set HG ( type O1 .or. type C1S .or. type C2S .or. type C3S .or. type NF .or. type O3 )
      set TL ( type C24F .or. type C18S )
      goto repeatrand
   endif
   if lipid .eq. QMPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C315 )
      goto repeatrand
   endif
   if lipid .eq. PMPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PMPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PPPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PVPE then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PVPG then
      calc zpostop = 19
      set HG ( type P .or. type C1+ .or. type O1+ .or. type OC+ )
      set TL ( type C218 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. APPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C215 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. IPPC then
      calc zpostop = 19
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C215 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. PHPC then
      calc zpostop = 17
      set HG ( type P .or. type N .or. type C1+ .or. type O1+ )
      set TL ( type C216 .or. type C316 )
      goto repeatrand
   endif
   if lipid .eq. LAU then
      calc zpostop = 12
      set HG ( type O1 .or. type O2 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. MYR then
      calc zpostop = 14
      set HG ( type O1 .or. type O2 )
      set TL ( type C14 )
      goto repeatrand
   endif
   if lipid .eq. PAL then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. STE then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. ARA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. BEH then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. TRI then
      calc zpostop = 23
      set HG ( type O1 .or. type O2 )
      set TL ( type C23 )
      goto repeatrand
   endif
   if lipid .eq. LIGN then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. MYRO then
      calc zpostop = 14
      set HG ( type O1 .or. type O2 )
      set TL ( type C14 )
      goto repeatrand
   endif
   if lipid .eq. PALO then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. HTA then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. OLE then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. LIN then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. ALIN then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. SDA then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. GLA then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. EICO then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. EDA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. MEA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. DGLA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ETE then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ETA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. EPA then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ARAN then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. HPA then
      calc zpostop = 21
      set HG ( type O1 .or. type O2 )
      set TL ( type C21 )
      goto repeatrand
   endif
   if lipid .eq. ERU then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DDA then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. ADR then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DPT then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DPA then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DHA then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. NER then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TTA then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TPT then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TPA then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. THA then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. LAUP then
      calc zpostop = 12
      set HG ( type O1 .or. type O2 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. MYRP then
      calc zpostop = 14
      set HG ( type O1 .or. type O2 )
      set TL ( type C14 )
      goto repeatrand
   endif
   if lipid .eq. PALP then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. STEP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. ARAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. BEHP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. TRIP then
      calc zpostop = 23
      set HG ( type O1 .or. type O2 )
      set TL ( type C23 )
      goto repeatrand
   endif
   if lipid .eq. LIGNP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. MYROP then
      calc zpostop = 14
      set HG ( type O1 .or. type O2 )
      set TL ( type C14 )
      goto repeatrand
   endif
   if lipid .eq. PALOP then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. HTAP then
      calc zpostop = 16
      set HG ( type O1 .or. type O2 )
      set TL ( type C16 )
      goto repeatrand
   endif
   if lipid .eq. OLEP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. LINP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. ALINP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. SDAP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. GLAP then
      calc zpostop = 18
      set HG ( type O1 .or. type O2 )
      set TL ( type C18 )
      goto repeatrand
   endif
   if lipid .eq. EICOP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. EDAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. MEAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. DGLAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ETEP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ETAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. EPAP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. ARANP then
      calc zpostop = 20
      set HG ( type O1 .or. type O2 )
      set TL ( type C20 )
      goto repeatrand
   endif
   if lipid .eq. HPAP then
      calc zpostop = 21
      set HG ( type O1 .or. type O2 )
      set TL ( type C21 )
      goto repeatrand
   endif
   if lipid .eq. ERUP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DDAP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. ADRP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DPTP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DPAP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. DHAP then
      calc zpostop = 22
      set HG ( type O1 .or. type O2 )
      set TL ( type C22 )
      goto repeatrand
   endif
   if lipid .eq. NERP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TTAP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TPTP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. TPAP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. THAP then
      calc zpostop = 24
      set HG ( type O1 .or. type O2 )
      set TL ( type C24 )
      goto repeatrand
   endif
   if lipid .eq. SDS then
      calc zpostop = 15.0
      set HG ( type S )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. LMPG then
      calc zpostop = 17.0
      set HG ( type P )
      set TL ( type C314 )
      goto repeatrand
   endif
   if lipid .eq. DHPC then
      calc zpostop = 10.0
      set HG ( type P )
      set TL ( type C37 .or. type C27 )
      goto repeatrand
   endif
   if lipid .eq. DPC then
      calc zpostop = 15.0
      set HG ( type P )
      set TL ( type C39 )
      goto repeatrand
   endif
   if lipid .eq. TPC then
      calc zpostop = 17.0
      set HG ( type P )
      set TL ( type C311 )
      goto repeatrand
   endif
   if lipid .eq. ADDG then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. BDDG then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. ADG then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C10 )
      goto repeatrand
   endif
   if lipid .eq. BDG then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C10 )
      goto repeatrand
   endif
   if lipid .eq. ADDM then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. BDDM then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. ADM then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C10 )
      goto repeatrand
   endif
   if lipid .eq. BDM then
      calc zpostop = 15.0
      set HG ( type 2C1 )
      set TL ( type C10 )
      goto repeatrand
   endif
   if lipid .eq. SB3-12 then
      calc zpostop = 15.0
      set HG ( type N )
      set TL ( type C12 )
      goto repeatrand
   endif
   if lipid .eq. SB3-14 then
      calc zpostop = 17.0
      set HG ( type N )
      set TL ( type C14 )
      goto repeatrand
   endif

   stop ! the lipid type is not defined
   !prnlev 5

   label repeatrand

      calc cntrand = @cntrand + 1
      if cntrand .gt. 100 stop ! replacement may not work.. stop here

      set randn ?RAND
      if randn .le. 0.5 set Lipdir conf1   ! conf1 and conf2 are two directories 
      if randn .gt. 0.5 set Lipdir conf2   ! containing lipid structures
      if randn .le. 0.001 goto repeatrand
      calc N = int( @randn * 1000 )   

      open read card unit 1 name lipid_lib//@lipid/@Lipdir/@lipid_@N.crd
      read sequence coor unit 1 
      generate L@LipidNum setup noangle nodihedrals first none last none
      close unit 1

      open read card unit 1 name lipid_lib//@lipid/@Lipdir/@lipid_@N.crd
      read coor card unit 1 append
      close unit 1

      coor print sele ( .not. INIT ) end
      ic param
      ic build
      prnlev 0
      hbuild
      prnlev 5
      coor print sele ( .not. INIT ) end
      if ?nsel .gt. 0 stop

      ! check to delete any lipids that have tail near head groups
      define ctl sele @tl end
      coor stat sele ctl end
      if ?ZAVE ge -5.0 then
         delete atoms sele segid L@LipidNum end 
         goto repeatrand
      endif

      ! put the X-Y center of mass of the lipid head at the origin 
      coor stat sele segid L@LipidNum .and. @HG end
      coor trans xdir -?XAVE ydir -?YAVE zdir -?ZAVE select segid L@LipidNum end

      ! randomly rotate along Z
      calc rotang = 360.0 * ?rand
      coor rotate zdir 1.0 phi @rotang select segid L@LipidNum end

      ! flip the orientation of the lipids in the lower monolayer if head Z le 0
      coor stat sele repack .and. @HG end 
      if ?ZMIN le 0  coor rotate xdir 1.0  phi 180.0 select segid L@LipidNum end

      ! put the head group at the location of the spheres
      coor stat sele repack .and. @HG end
      if ?ZMIN gt 0.0 coor trans xdir ?XMIN ydir ?YMIN zdir  @ZPosTOP select segid L@LipidNum end
      if ?ZMIN le 0.0 coor trans xdir ?XMIN ydir ?YMIN zdir -@ZPosTOP select segid L@LipidNum end

      set xhead = ?xave
      set yhead = ?yave
      set zhead = ?zave
      set rhead = ?wave

      set nbad = 5 
      ! increase the lipid bad contact limit for cardiolipin
      if lipid .eq. TMCL1  set nbad = 10
      if lipid .eq. TMCL2  set nbad = 10
      if lipid .eq. PMCL1  set nbad = 10
      if lipid .eq. PMCL2  set nbad = 10
      if lipid .eq. PVCL2  set nbad = 10
      if lipid .eq. TXCL1  set nbad = 10
      if lipid .eq. TXCL2  set nbad = 10
      if lipid .eq. TOCL1  set nbad = 10
      if lipid .eq. TOCL2  set nbad = 10
      if lipid .eq. LOACL1 set nbad = 10
      if lipid .eq. LOACL2 set nbad = 10
      if lipid .eq. LOCCL1 set nbad = 10
      if lipid .eq. LOCCL2 set nbad = 10
      if lipid .eq. TLCL1  set nbad = 10
      if lipid .eq. TLCL2  set nbad = 10
      if lipid .eq. LNCCL1 set nbad = 10
      if lipid .eq. LNCCL2 set nbad = 10
      if lipid .eq. LNACL1 set nbad = 10
      if lipid .eq. LNACL2 set nbad = 10
      if lipid .eq. LNDCL1 set nbad = 10
      if lipid .eq. LNDCL2 set nbad = 10
      if lipid .eq. LNBCL1 set nbad = 10
      if lipid .eq. LNBCL2 set nbad = 10

      !
      ! check whether the lipid penetrates the protein (or cholesterol)
      !

      calc delang    = 35.0   ! rotation increment
      calc delxy     =  1.0   ! xy translation increment

      define target sele segid L@LipidNum end 

      calc xmove = 0.0
      calc ymove = 0.0
      calc nxymove = 1

      label doxymove

         if nxymove .eq. 2 incr xmove by 1
         if nxymove .eq. 3 incr ymove by 1
         if nxymove .eq. 4 decr xmove by 1
         if nxymove .eq. 5 decr xmove by 1
         if nxymove .eq. 6 decr ymove by 1
         if nxymove .eq. 7 decr ymove by 1
         if nxymove .eq. 8 incr xmove by 1
         if nxymove .eq. 9 incr xmove by 1

         !protein-head distance check for close ones
         !
         if rhead .le. 7.0 then 
            coor trans xdir @xmove ydir @ymove sele target end
            coor stat sele target .and. @HG end
            coor set xdir ?xave ydir ?yave zdir ?zave sele segid dum end
            coor mindist sele segid dum end sele PROT .and. .not. hydrogen end
            if nxymove .eq. 1 set mind1 = ?mind
            if nxymove .eq. 9 then
               if ?mind .lt. @mind1 then
                  delete atoms sele segid L@LipidNum end 
                  goto repeatrand
               endif
            endif
            if ?mind .lt. @mind1 goto doxymove

            ! ring dummy atom initial coordinate
            coor set xdir 9000.0 ydir 9000.0 zdir 9000.0 sele segid dum end  
         endif

         calc xtran = @xhead + @xmove
         calc ytran = @yhead + @ymove

         calc rotang = 0.0 
         label dorot

            coor rotate zdir 1.0 xcen @xtran ycen @ytran zcen @zhead phi @rotang sele target end

            set dotrans = 1
            label doclash
               if dotrans .eq. 2 coor trans xdir  1.0 ydir  1.0 dist 0.71 sele target end
               if dotrans .eq. 3 coor trans xdir  1.0 ydir -1.0 dist 0.71 sele target end
               if dotrans .eq. 4 coor trans xdir -1.0 ydir  1.0 dist 0.71 sele target end
               if dotrans .eq. 5 coor trans xdir -1.0 ydir -1.0 dist 0.71 sele target end

               if lipid .ne. CHL1 then
                  if nchl1 .gt. 0 then  
                     ! to prevent the penetration of lipid molecules into cholesterol rings
                     coor dist cut 1.0 sele segid L@LipidNum .and. .not. resname TIP3 .and. .not. hydrogen end  -
                                       sele ( resname CHL1 .and. ( type c% .or. type c1* ) ) .or. segid DUM end 
                     if ?npair gt 0 goto domorerot
                  endif

                  !protein-check
                  !
                  coor dist cut 1.7 sele segid L@LipidNum .and. .not. resname TIP3 .and. .not. hydrogen end  -
                                      sele .not. ( segid L* .or. resname TIP3 .or. segid MEMB ) .and. .not. hydrogen end
                  if ?npair gt 8 goto domorerot

                  !lipid-check
                  !
                  coor dist cut 1.2 sele segid L@LipidNum .and. .not. resname TIP3 .and. .not. hydrogen end  -
                                      sele .not. ( segid L* .or. resname TIP3 .or. PROT ) .and. .not. hydrogen end
                  if ?npair gt @nbad goto domorerot
               endif

               if lipid .eq. CHL1 then
                  coor dist cut 1.0 sele segid L@LipidNum .and. ( type c% .or. type c1* ) end  -
                                    sele .not. ( segid L* .or. type POLO .or. resname TIP3 ) .and. .not. hydrogen end
                  if ?npair gt 0 goto domorerot
               endif

               if dotrans .eq. 2 coor trans xdir -1.0 ydir -1.0 dist 0.71 sele target end
               if dotrans .eq. 3 coor trans xdir -1.0 ydir  1.0 dist 0.71 sele target end
               if dotrans .eq. 4 coor trans xdir  1.0 ydir -1.0 dist 0.71 sele target end
               if dotrans .eq. 5 coor trans xdir  1.0 ydir  1.0 dist 0.71 sele target end

            incr dotrans by 1
            if dotrans .le. 5 goto doclash

            goto nextlipid

         label domorerot
         increase rotang by @delang
         if rotang .le. 359 goto dorot

         coor trans xdir -@xmove ydir -@ymove sele target end
      increase nxymove by 1
      if nxymove .le. 9 goto doxymove

      delete atoms sele segid L@LipidNum end
      goto repeatrand

      label nextlipid
      coor dupl sele segid L@LipidNum end sele repack end
      delete atom sele segid L@LipidNUm end

   ! continue for total number of lipids that are needed
   incr LipidNum by 1

if LipidNum le @NLipid goto loop_gen

delete atom sele segid DUM end

!==============================================================================
! Write the coordinates
!

open write unit 10 card name step4_lipid.pdb
write coor unit 10 pdb
close unit 10

open write unit 10 card name step4_lipid.crd
write coor unit 10 card
close unit 10

define water sele resn tip3 end
if ?nsel .gt. 0 delete atom sele resn TIP3 end
open write unit 10 card name step4_lipid_lipid.crd
write coor unit 10 card sele segid memb end
close unit 10

stop